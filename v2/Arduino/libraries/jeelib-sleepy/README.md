This snippet is pulled from the jeelib PORTS library.
https://github.com/jcw/jeelib